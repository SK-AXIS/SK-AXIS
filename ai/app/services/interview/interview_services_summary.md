# SK AXIS AI 면접 서비스 모듈 가이드

## 🎯 전체 아키텍처 개요

SK AXIS AI 면접 시스템은 음성 인식부터 평가까지 전체 파이프라인을 자동화합니다.

**데이터 흐름:**
```
WebM 오디오 → STT → 리라이팅 → 평가 → 요약
```

## 📁 서비스 모듈별 상세 설명

### stt_service.py
**역할:** 음성 파일을 텍스트로 변환
- **입력:** WebM 오디오 파일
- **처리:** OpenAI Whisper API 기반 한국어 음성 인식
- **출력:** STT 텍스트 세그먼트
- **최적화:** 파일 헤더 검증으로 3000배 속도 향상, 손상 파일 사전 감지
- **후처리:** 유튜브 관련 오인식 필터링

### rewrite_service.py
**역할:** STT 결과를 문법적으로 정제
- **입력:** STT 원본 텍스트 (문법 오류, 공백 문제 포함)
- **처리:** GPT-4o-mini 기반 의미 보존 정제
- **출력:** 문법 수정 및 정리된 면접 답변
- **원칙:** 지원자 의도 보존, 면접관 발언 제거, 평가 적합 형태 변환

### evaluation_service.py
**역할:** 정제된 답변을 키워드 기반으로 평가
- **입력:** 정제된 면접 답변 텍스트
- **처리:** 8개 키워드 × 3개 세부 항목 = 24개 항목 평가
- **평가 영역:**
  - 인성적 요소 (90점): SUPEX, VWBE, Passionate, Proactive, Professional, People
  - 기술/직무 (15점): 실무 기술/지식, 문제 해결 적용력, 학습 발전 가능성
  - 도메인 전문성 (15점): 도메인 이해도, 실제 사례 적용, 전략적 사고력
- **출력:** 점수, 인용구, 평가 사유 포함 상세 결과

### nonverbal_service.py
**역할:** 비언어적 요소 (표정) 평가
- **입력:** 표정 데이터 (smile, neutral, frown, angry 횟수)
- **처리:** GPT-4o-mini 기반 표정 패턴 분석
- **출력:** 0.0~1.0 정규화 점수 (15점 만점으로 환산)
- **평가 기준:** 적절한 표정 변화, 자연스러운 웃음, 면접 상황 적합성

### graph_pipeline.py
**역할:** 전체 평가 파이프라인 오케스트레이션
- **기능:** LangGraph 기반 상태 기계로 전체 흐름 관리
- **단계:** STT → 리라이팅 → 비언어 평가 → 언어 평가 → 검증 → 요약
- **특징:** 재시도 로직 (최대 1회), 단계별 상태 추적, 에러 처리
- **최종 출력:** 100점 만점 환산 점수 및 상세 분석 결과

### interview_end_processing_service.py
**역할:** 면접 종료 시 마지막 처리 작업
- **기능:** 마지막 오디오 세그먼트 처리, 비언어적 데이터 저장
- **처리:** 전체 파이프라인 실행 후 임시 파일 정리
- **데이터 저장:** 표정, 자세, 시선, 제스처 데이터 상태 보관

### state_service.py
**역할:** 면접 상태 초기화 및 구조 정의
- **기능:** 새 면접 세션의 초기 상태 생성
- **구조:** 파이프라인 각 단계별 상태, 결과 저장소, 처리 로그
- **표준화:** 일관된 데이터 구조 및 기본값 설정

### queue_executor.py
**역할:** 면접자별 비동기 작업 큐 관리
- **기능:** 순차 처리 보장, 동시성 제어, 예외 처리
- **특징:** 면접자별 독립 큐, 백그라운드 처리, 작업 충돌 방지

### store.py
**역할:** 전역 메모리 상태 저장소
- **기능:** 면접자별 상태 정보 임시 저장, API 간 상태 공유
- **구조:** Dict[interviewee_id, InterviewState]
- **주의:** 메모리 기반으로 서버 재시작 시 데이터 소실

## 🔄 처리 흐름 요약

1. **면접 시작:** `state_service`로 초기 상태 생성 → `store`에 저장
2. **오디오 처리:** `queue_executor`로 순차 처리 관리
3. **파이프라인 실행:** `graph_pipeline`이 전체 흐름 오케스트레이션
4. **각 단계 실행:** STT → 리라이팅 → 평가 → 요약
5. **결과 저장:** 각 단계 결과를 `store`의 상태에 누적 저장
6. **면접 종료:** `interview_end_processing_service`로 마무리 처리

## 💰 비용 최적화 현황

- **모델 변경:** gpt-4o → gpt-4o-mini (94% 비용 절감)
- **재시도 제한:** 최대 1회 재시도로 무한 루프 방지
- **파일 검증:** 헤더만 읽어 3000배 속도 향상
- **결과:** 월 30,000 TPM 기준 ~$0.60 → ~$0.036 (94% 절약)

